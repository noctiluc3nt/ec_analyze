<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>8 Surface energy balance | Reddy: A toolbox for analyzing eddy-covariance measurements</title>
  <meta name="description" content="8 Surface energy balance | Reddy: A toolbox for analyzing eddy-covariance measurements" />
  <meta name="generator" content="bookdown 0.40 and GitBook 2.6.7" />

  <meta property="og:title" content="8 Surface energy balance | Reddy: A toolbox for analyzing eddy-covariance measurements" />
  <meta property="og:type" content="book" />
  
  
  <meta name="github-repo" content="noctiluc3nt/Reddy" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="8 Surface energy balance | Reddy: A toolbox for analyzing eddy-covariance measurements" />
  
  
  




  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="flux-footprint.html"/>
<link rel="next" href="references.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="https://github.com/noctiluc3nt/Reddy" target="blank"><bf>Reddy<bf></a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#measurement-setup-and-instrumentation"><i class="fa fa-check"></i><b>1.1</b> Measurement setup and instrumentation</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#data-sources"><i class="fa fa-check"></i><b>1.2</b> Data sources</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="post-processing-of-raw-eddy-covariance-data.html"><a href="post-processing-of-raw-eddy-covariance-data.html"><i class="fa fa-check"></i><b>2</b> Post-processing of raw eddy-covariance data</a>
<ul>
<li class="chapter" data-level="2.1" data-path="post-processing-of-raw-eddy-covariance-data.html"><a href="post-processing-of-raw-eddy-covariance-data.html#eddy-covariance-method"><i class="fa fa-check"></i><b>2.1</b> Eddy-covariance method</a></li>
<li class="chapter" data-level="2.2" data-path="post-processing-of-raw-eddy-covariance-data.html"><a href="post-processing-of-raw-eddy-covariance-data.html#raw-data-handling-and-corrections"><i class="fa fa-check"></i><b>2.2</b> Raw data handling and corrections</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="post-processing-of-raw-eddy-covariance-data.html"><a href="post-processing-of-raw-eddy-covariance-data.html#choosing-a-suitable-averaging-time"><i class="fa fa-check"></i><b>2.2.1</b> Choosing a suitable averaging time</a></li>
<li class="chapter" data-level="2.2.2" data-path="post-processing-of-raw-eddy-covariance-data.html"><a href="post-processing-of-raw-eddy-covariance-data.html#overview-of-correction-procedures-applied-to-the-raw-data"><i class="fa fa-check"></i><b>2.2.2</b> Overview of correction procedures applied to the raw data</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="post-processing-of-raw-eddy-covariance-data.html"><a href="post-processing-of-raw-eddy-covariance-data.html#an-example-post-processing-routine"><i class="fa fa-check"></i><b>2.3</b> An example post-processing routine</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="turbulence-diagnostics.html"><a href="turbulence-diagnostics.html"><i class="fa fa-check"></i><b>3</b> Turbulence diagnostics</a>
<ul>
<li class="chapter" data-level="3.1" data-path="turbulence-diagnostics.html"><a href="turbulence-diagnostics.html#standard-turbulence-diagnostics-and-fluxes"><i class="fa fa-check"></i><b>3.1</b> Standard turbulence diagnostics and fluxes</a></li>
<li class="chapter" data-level="3.2" data-path="turbulence-diagnostics.html"><a href="turbulence-diagnostics.html#stability-dependence"><i class="fa fa-check"></i><b>3.2</b> Stability dependence</a></li>
<li class="chapter" data-level="3.3" data-path="turbulence-diagnostics.html"><a href="turbulence-diagnostics.html#turbulence-regimes-and-hockey-stick-model"><i class="fa fa-check"></i><b>3.3</b> Turbulence regimes and “Hockey-stick” model</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="quadrant-analysis.html"><a href="quadrant-analysis.html"><i class="fa fa-check"></i><b>4</b> Quadrant analysis</a>
<ul>
<li class="chapter" data-level="4.1" data-path="quadrant-analysis.html"><a href="quadrant-analysis.html#calculation-of-occurrence-frequencies-and-strengths-of-the-four-quadrants-with-calc_quadrant_analysis"><i class="fa fa-check"></i><b>4.1</b> Calculation of occurrence frequencies and strengths of the four quadrants with <code>calc_quadrant_analysis</code></a></li>
<li class="chapter" data-level="4.2" data-path="quadrant-analysis.html"><a href="quadrant-analysis.html#plotting-quadrant-analysis-with-plot_quadrant_analysis"><i class="fa fa-check"></i><b>4.2</b> Plotting quadrant analysis with <code>plot_quadrant_analysis</code></a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="spectra.html"><a href="spectra.html"><i class="fa fa-check"></i><b>5</b> Spectra</a>
<ul>
<li class="chapter" data-level="5.1" data-path="spectra.html"><a href="spectra.html#spectral-analysis-of-timeseries"><i class="fa fa-check"></i><b>5.1</b> Spectral analysis of timeseries</a></li>
<li class="chapter" data-level="5.2" data-path="spectra.html"><a href="spectra.html#fft-spectrum-and-comparison-to-theoretical-spectra"><i class="fa fa-check"></i><b>5.2</b> FFT spectrum and comparison to theoretical spectra</a></li>
<li class="chapter" data-level="5.3" data-path="spectra.html"><a href="spectra.html#multiresolution-decomposition-mrd"><i class="fa fa-check"></i><b>5.3</b> Multiresolution decomposition (MRD)</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="spectra.html"><a href="spectra.html#calculating-multiresolution-decomposition-with-calc_mrd"><i class="fa fa-check"></i><b>5.3.1</b> Calculating multiresolution decomposition with <code>calc_mrd</code></a></li>
<li class="chapter" data-level="5.3.2" data-path="spectra.html"><a href="spectra.html#plotting-multiresolution-decomposition-with-plot_mrd"><i class="fa fa-check"></i><b>5.3.2</b> Plotting multiresolution decomposition with <code>plot_mrd</code></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="reynolds-stress-tensor.html"><a href="reynolds-stress-tensor.html"><i class="fa fa-check"></i><b>6</b> Reynolds stress tensor</a>
<ul>
<li class="chapter" data-level="6.1" data-path="reynolds-stress-tensor.html"><a href="reynolds-stress-tensor.html#invariant-analysis-of-the-reynolds-stress-tensor"><i class="fa fa-check"></i><b>6.1</b> Invariant analysis of the Reynolds stress tensor</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="reynolds-stress-tensor.html"><a href="reynolds-stress-tensor.html#performing-the-invariant-analysis-of-the-reynolds-stress-tensor-with-calc_anisotropy"><i class="fa fa-check"></i><b>6.1.1</b> Performing the invariant analysis of the Reynolds stress tensor with <code>calc_anisotropy</code></a></li>
<li class="chapter" data-level="6.1.2" data-path="reynolds-stress-tensor.html"><a href="reynolds-stress-tensor.html#plotting-the-barycentric-map-using-plot_barycentric_map"><i class="fa fa-check"></i><b>6.1.2</b> Plotting the barycentric map using <code>plot_barycentric_map</code></a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="reynolds-stress-tensor.html"><a href="reynolds-stress-tensor.html#anisotropy-and-velocity-aspect-ratio-var"><i class="fa fa-check"></i><b>6.2</b> Anisotropy and velocity aspect ratio (VAR)</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="flux-footprint.html"><a href="flux-footprint.html"><i class="fa fa-check"></i><b>7</b> Flux footprint</a>
<ul>
<li class="chapter" data-level="7.1" data-path="flux-footprint.html"><a href="flux-footprint.html#flux-footprint-parametrizations"><i class="fa fa-check"></i><b>7.1</b> Flux footprint parametrizations</a></li>
<li class="chapter" data-level="7.2" data-path="flux-footprint.html"><a href="flux-footprint.html#d-flux-footprint-estimate"><i class="fa fa-check"></i><b>7.2</b> 2D flux footprint estimate</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="flux-footprint.html"><a href="flux-footprint.html#calculate-2d-flux-footprint-estimate-with-calc_flux_footprint"><i class="fa fa-check"></i><b>7.2.1</b> Calculate 2D flux footprint estimate with <code>calc_flux_footprint</code></a></li>
<li class="chapter" data-level="7.2.2" data-path="flux-footprint.html"><a href="flux-footprint.html#plotting-of-flux-footprint-with-plot_flux_footprint"><i class="fa fa-check"></i><b>7.2.2</b> Plotting of flux footprint with <code>plot_flux_footprint</code></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="surface-energy-balance.html"><a href="surface-energy-balance.html"><i class="fa fa-check"></i><b>8</b> Surface energy balance</a>
<ul>
<li class="chapter" data-level="8.1" data-path="surface-energy-balance.html"><a href="surface-energy-balance.html#surface-energy-balance-closure"><i class="fa fa-check"></i><b>8.1</b> Surface energy balance closure</a></li>
<li class="chapter" data-level="8.2" data-path="surface-energy-balance.html"><a href="surface-energy-balance.html#calculating-surface-energy-balance"><i class="fa fa-check"></i><b>8.2</b> Calculating surface energy balance</a></li>
<li class="chapter" data-level="8.3" data-path="surface-energy-balance.html"><a href="surface-energy-balance.html#hydrological-measures-bowen-ratio-and-evaporative-fraction"><i class="fa fa-check"></i><b>8.3</b> Hydrological measures: Bowen ratio and evaporative fraction</a></li>
<li class="chapter" data-level="8.4" data-path="surface-energy-balance.html"><a href="surface-energy-balance.html#meteorological-contextualization"><i class="fa fa-check"></i><b>8.4</b> Meteorological contextualization</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i><b>9</b> References</a></li>
<li class="divider"></li>
<li><a href="https://bookdown.org" target="blank">Published with bookdown <br>(Laura Mack, 2024)</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Reddy: A toolbox for analyzing eddy-covariance measurements</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="surface-energy-balance" class="section level1 hasAnchor" number="8">
<h1><span class="header-section-number">8</span> Surface energy balance<a href="surface-energy-balance.html#surface-energy-balance" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="surface-energy-balance-closure" class="section level2 hasAnchor" number="8.1">
<h2><span class="header-section-number">8.1</span> Surface energy balance closure<a href="surface-energy-balance.html#surface-energy-balance-closure" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The surface energy balance (SEB) is a framework to describe exchange processes between atmosphere and land, and can be written as
<span class="math display">\[
                R_{net} - G  = SH + LH + I_{SEB}            
            \]</span>
with net radiation <span class="math inline">\(R_{net} = SW\downarrow - SW\uparrow + LW\downarrow - LW\uparrow\)</span> (combining shortwave (SW) and longwave (LW), incoming (<span class="math inline">\(\downarrow\)</span>) and outgoing (<span class="math inline">\(\uparrow\)</span>) radiative fluxes) and the ground heat flux <span class="math inline">\(G\)</span>. The turbulent fluxes are given by
<span class="math display">\[\begin{align}
                SH = \rho c_p \overline{w&#39;T&#39;} \quad \textrm{  and  } \quad LH = \rho L_v \overline{w&#39;q&#39;}
            \end{align}\]</span>
with the air density <span class="math inline">\(\rho\)</span>, the heat capacity of air (under constant pressure) <span class="math inline">\(c_p\)</span> and the latent heat of vaporization <span class="math inline">\(L_v\)</span>.
The sensible heat flux SH is positive under unstable conditions (ground heats atmosphere) and negative under stable conditions (atmosphere heats ground).
Positive latent heat fluxes (LH) represent evaporation or transpiration, whereas negative LH indicates condensation or deposition of water (vapor).
The last term <span class="math inline">\(I_{SEB}\)</span> describes the imbalance (or residual flux). Depending on the value of <span class="math inline">\(I_{SEB}\)</span>, the SEB is called closed or unclosed
<span class="math display">\[\begin{align}
                I_{SEB} \begin{cases}
                    = 0 \rightarrow \textrm{closed} \\
                    \ne 0 \rightarrow \textrm{unclosed}
                \end{cases}
            \quad \textrm{and} \quad
            CR := \frac{R_{net}-G}{SH+LH} \begin{cases}
                = 1 \rightarrow \textrm{closed} \\
                \ne 1 \rightarrow \textrm{unclosed},
            \end{cases} 
            \end{align}\]</span>
which can also be expressed in a relative measure, the closure ratio CR. The advantage of the closure ratio is the normalization by the available radiation, but the disadvantage is a cancellation of biases. <span class="citation">Wilson and others (<a href="#ref-Wilson2002" role="doc-biblioref">2002</a>)</span> showed based on the FLUXNET towers, that there is on average a SEB unclosure of 20-30 %. Reasons for the unclosure are (similar to the TKE budget unclosure) horizontal advection, flux divergence, submeso-scale motions, different measurement footprints, melting, runoff or rain fluxes, canopy interactions as well as possible measurement and post-processing errors (as in great detail reviewed by <span class="citation">Mauder, Foken, and Cuxart (<a href="#ref-Mauder2020" role="doc-biblioref">2020</a>)</span>). <span class="citation">Stoy et al. (<a href="#ref-Stoy2013" role="doc-biblioref">2013</a>)</span> found a larger unclosure in heterogeneous terrain and a correlation with friction velocity.</p>
</div>
<div id="calculating-surface-energy-balance" class="section level2 hasAnchor" number="8.2">
<h2><span class="header-section-number">8.2</span> Calculating surface energy balance<a href="surface-energy-balance.html#calculating-surface-energy-balance" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="surface-energy-balance.html#cb44-1" aria-hidden="true"></a><span class="co">#loading Reddy package</span></span>
<span id="cb44-2"><a href="surface-energy-balance.html#cb44-2" aria-hidden="true"></a><span class="kw">install.packages</span>(<span class="st">&quot;../src/Reddy_0.0.0.9000.tar.gz&quot;</span>,<span class="dt">repos=</span><span class="ot">NULL</span>,<span class="dt">source=</span><span class="ot">TRUE</span>,<span class="dt">quiet=</span><span class="ot">TRUE</span>)</span>
<span id="cb44-3"><a href="surface-energy-balance.html#cb44-3" aria-hidden="true"></a><span class="kw">library</span>(Reddy)</span>
<span id="cb44-4"><a href="surface-energy-balance.html#cb44-4" aria-hidden="true"></a><span class="kw">library</span>(dplyr)</span>
<span id="cb44-5"><a href="surface-energy-balance.html#cb44-5" aria-hidden="true"></a>sigma=<span class="fl">5.67</span><span class="op">*</span><span class="dv">10</span><span class="op">^</span>(<span class="op">-</span><span class="dv">8</span>)</span>
<span id="cb44-6"><a href="surface-energy-balance.html#cb44-6" aria-hidden="true"></a></span>
<span id="cb44-7"><a href="surface-energy-balance.html#cb44-7" aria-hidden="true"></a><span class="co">#read in processed example data</span></span>
<span id="cb44-8"><a href="surface-energy-balance.html#cb44-8" aria-hidden="true"></a>dat=<span class="kw">readRDS</span>(<span class="st">&quot;../data/ec-data_30min_processed/processed_data_example.rds&quot;</span>)</span>
<span id="cb44-9"><a href="surface-energy-balance.html#cb44-9" aria-hidden="true"></a>dat<span class="op">$</span>TIME=<span class="kw">as.POSIXct</span>(dat<span class="op">$</span>time,<span class="dt">format=</span><span class="st">&quot;%F %T&quot;</span>)</span></code></pre></div>
<p><strong>Plotting of surface energy balance with <code>plot_seb</code></strong> <br>
The function <code>plot_seb</code>plots the surface energy balance as time series and as scatter plot (R-GH, SH+LH) with linear regression as well as calculates the residual flux and the closure ratio.
In addition to the turbulence data used so far (which contains the two turbulent fluxes <code>SH, LH</code>), we now also need additional radiative measurements (all four radiative fluxes <code>SWin, SWout, LWin, LWout</code>) and the ground heat flux (<code>GH</code>), which are available in the file <code>../data/radiation-data_30min/biomet_data.csv</code> as 30 minutes averages.</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="surface-energy-balance.html#cb45-1" aria-hidden="true"></a><span class="co">#read in radiation data</span></span>
<span id="cb45-2"><a href="surface-energy-balance.html#cb45-2" aria-hidden="true"></a>dat_rad=<span class="kw">read.table</span>(<span class="st">&quot;../data//radiation-data_30min//biomet_data.csv&quot;</span>,<span class="dt">sep=</span><span class="st">&quot;,&quot;</span>,<span class="dt">header=</span>T)</span>
<span id="cb45-3"><a href="surface-energy-balance.html#cb45-3" aria-hidden="true"></a><span class="kw">colnames</span>(dat_rad)=<span class="kw">c</span>(<span class="st">&quot;time&quot;</span>,<span class="st">&quot;rh&quot;</span>,<span class="st">&quot;ta&quot;</span>,<span class="st">&quot;swin&quot;</span>,<span class="st">&quot;swout&quot;</span>,<span class="st">&quot;lwin&quot;</span>,<span class="st">&quot;lwout&quot;</span>,<span class="st">&quot;shf1&quot;</span>,<span class="st">&quot;shf2&quot;</span>)</span>
<span id="cb45-4"><a href="surface-energy-balance.html#cb45-4" aria-hidden="true"></a>dat_rad<span class="op">$</span>TIME=<span class="kw">as.POSIXct</span>(dat_rad<span class="op">$</span>time,<span class="dt">format=</span><span class="st">&quot;%F %T&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="surface-energy-balance.html#cb46-1" aria-hidden="true"></a>dat=<span class="kw">inner_join</span>(dat,dat_rad,<span class="dt">by=</span><span class="st">&quot;TIME&quot;</span>)</span>
<span id="cb46-2"><a href="surface-energy-balance.html#cb46-2" aria-hidden="true"></a><span class="kw">head</span>(dat)</span></code></pre></div>
<table class="dataframe">
<caption>
A data.frame: 6 × 40
</caption>
<thead>
<tr>
<th>
</th>
<th scope="col">
time.x
</th>
<th scope="col">
u_mean
</th>
<th scope="col">
v_mean
</th>
<th scope="col">
w_mean
</th>
<th scope="col">
ws_mean
</th>
<th scope="col">
wd_mean
</th>
<th scope="col">
T_mean
</th>
<th scope="col">
h2o_mean
</th>
<th scope="col">
co2_mean
</th>
<th scope="col">
u_sd
</th>
<th scope="col">
⋯
</th>
<th scope="col">
TIME
</th>
<th scope="col">
time.y
</th>
<th scope="col">
rh
</th>
<th scope="col">
ta
</th>
<th scope="col">
swin
</th>
<th scope="col">
swout
</th>
<th scope="col">
lwin
</th>
<th scope="col">
lwout
</th>
<th scope="col">
shf1
</th>
<th scope="col">
shf2
</th>
</tr>
<tr>
<th>
</th>
<th scope="col">
&lt;chr&gt;
</th>
<th scope="col">
&lt;dbl&gt;
</th>
<th scope="col">
&lt;dbl&gt;
</th>
<th scope="col">
&lt;dbl&gt;
</th>
<th scope="col">
&lt;dbl&gt;
</th>
<th scope="col">
&lt;dbl&gt;
</th>
<th scope="col">
&lt;dbl&gt;
</th>
<th scope="col">
&lt;dbl&gt;
</th>
<th scope="col">
&lt;dbl&gt;
</th>
<th scope="col">
&lt;dbl&gt;
</th>
<th scope="col">
⋯
</th>
<th scope="col">
&lt;dttm&gt;
</th>
<th scope="col">
&lt;chr&gt;
</th>
<th scope="col">
&lt;dbl&gt;
</th>
<th scope="col">
&lt;dbl&gt;
</th>
<th scope="col">
&lt;dbl&gt;
</th>
<th scope="col">
&lt;dbl&gt;
</th>
<th scope="col">
&lt;dbl&gt;
</th>
<th scope="col">
&lt;dbl&gt;
</th>
<th scope="col">
&lt;dbl&gt;
</th>
<th scope="col">
&lt;dbl&gt;
</th>
</tr>
</thead>
<tbody>
<tr>
<th scope="row">
1
</th>
<td>
2018-07-20 08:30:00
</td>
<td>
2.872084
</td>
<td>
-3.939352e-16
</td>
<td>
6.931732e-06
</td>
<td>
2.873170
</td>
<td>
-2.289284
</td>
<td>
15.86938
</td>
<td>
0.007254132
</td>
<td>
0.0006009614
</td>
<td>
1.062143
</td>
<td>
⋯
</td>
<td>
2018-07-20 08:30:00
</td>
<td>
2018-07-20 08:30:00
</td>
<td>
56.54792
</td>
<td>
16.28775
</td>
<td>
715.4410
</td>
<td>
105.7314
</td>
<td>
312.4243
</td>
<td>
458.7009
</td>
<td>
21.59691
</td>
<td>
1.682706
</td>
</tr>
<tr>
<th scope="row">
2
</th>
<td>
2018-07-20 09:00:00
</td>
<td>
2.864793
</td>
<td>
7.504684e-17
</td>
<td>
9.052527e-08
</td>
<td>
2.864538
</td>
<td>
-2.326045
</td>
<td>
16.55190
</td>
<td>
0.007584267
</td>
<td>
0.0005978138
</td>
<td>
1.105122
</td>
<td>
⋯
</td>
<td>
2018-07-20 09:00:00
</td>
<td>
2018-07-20 09:00:00
</td>
<td>
54.34070
</td>
<td>
16.77433
</td>
<td>
756.2658
</td>
<td>
109.9171
</td>
<td>
319.3567
</td>
<td>
460.9099
</td>
<td>
26.81290
</td>
<td>
1.952374
</td>
</tr>
<tr>
<th scope="row">
3
</th>
<td>
2018-07-20 09:30:00
</td>
<td>
3.996526
</td>
<td>
9.365292e-16
</td>
<td>
3.049021e-05
</td>
<td>
4.002522
</td>
<td>
-2.035397
</td>
<td>
17.05704
</td>
<td>
0.007472065
</td>
<td>
0.0005954894
</td>
<td>
1.409495
</td>
<td>
⋯
</td>
<td>
2018-07-20 09:30:00
</td>
<td>
2018-07-20 09:30:00
</td>
<td>
47.65451
</td>
<td>
17.40209
</td>
<td>
797.9751
</td>
<td>
112.8786
</td>
<td>
301.3082
</td>
<td>
463.2456
</td>
<td>
30.59997
</td>
<td>
2.139507
</td>
</tr>
<tr>
<th scope="row">
4
</th>
<td>
2018-07-20 10:00:00
</td>
<td>
4.998016
</td>
<td>
-2.812846e-16
</td>
<td>
-2.391239e-06
</td>
<td>
4.997530
</td>
<td>
-1.977737
</td>
<td>
17.60447
</td>
<td>
0.006762097
</td>
<td>
0.0005953881
</td>
<td>
1.289326
</td>
<td>
⋯
</td>
<td>
2018-07-20 10:00:00
</td>
<td>
2018-07-20 10:00:00
</td>
<td>
36.98989
</td>
<td>
18.08719
</td>
<td>
809.7048
</td>
<td>
114.7406
</td>
<td>
295.6089
</td>
<td>
467.7517
</td>
<td>
33.01136
</td>
<td>
2.270067
</td>
</tr>
<tr>
<th scope="row">
5
</th>
<td>
2018-07-20 10:30:00
</td>
<td>
4.879095
</td>
<td>
4.062636e-16
</td>
<td>
2.187117e-05
</td>
<td>
4.880696
</td>
<td>
-2.014489
</td>
<td>
18.08994
</td>
<td>
0.005410862
</td>
<td>
0.0005948927
</td>
<td>
1.469949
</td>
<td>
⋯
</td>
<td>
2018-07-20 10:30:00
</td>
<td>
2018-07-20 10:30:00
</td>
<td>
30.13753
</td>
<td>
18.32750
</td>
<td>
823.0150
</td>
<td>
117.3849
</td>
<td>
291.3130
</td>
<td>
469.1732
</td>
<td>
34.70869
</td>
<td>
2.299792
</td>
</tr>
<tr>
<th scope="row">
6
</th>
<td>
2018-07-20 11:00:00
</td>
<td>
5.225037
</td>
<td>
-8.977916e-17
</td>
<td>
-6.972624e-06
</td>
<td>
5.223984
</td>
<td>
-2.261205
</td>
<td>
18.24207
</td>
<td>
0.004422858
</td>
<td>
0.0005954766
</td>
<td>
1.319227
</td>
<td>
⋯
</td>
<td>
2018-07-20 11:00:00
</td>
<td>
2018-07-20 11:00:00
</td>
<td>
25.45414
</td>
<td>
18.60887
</td>
<td>
827.8588
</td>
<td>
118.4659
</td>
<td>
288.2217
</td>
<td>
467.7229
</td>
<td>
34.78918
</td>
<td>
2.284315
</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="surface-energy-balance.html#cb47-1" aria-hidden="true"></a><span class="kw">plot_seb</span>(dat<span class="op">$</span>swin,dat<span class="op">$</span>swout,dat<span class="op">$</span>lwin,dat<span class="op">$</span>lwout,dat<span class="op">$</span>sh,dat<span class="op">$</span>lh,dat<span class="op">$</span>shf1)</span></code></pre></div>
<p><img src="figures/fig_0801.png" width="500" /></p>
<pre><code>Call:
lm(formula = y ~ x)

Residuals:
    Min      1Q  Median      3Q     Max 
-134.13  -19.47   -5.41   28.33  170.39 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) 27.66214    5.45569    5.07  1.4e-06 ***
x            0.52887    0.02051   25.78  &lt; 2e-16 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 48.56 on 125 degrees of freedom
Multiple R-squared:  0.8417,    Adjusted R-squared:  0.8405 
F-statistic: 664.7 on 1 and 125 DF,  p-value: &lt; 2.2e-16</code></pre>
<p><img src="figures/fig_0802.png" width="500" /></p>
</div>
<div id="hydrological-measures-bowen-ratio-and-evaporative-fraction" class="section level2 hasAnchor" number="8.3">
<h2><span class="header-section-number">8.3</span> Hydrological measures: Bowen ratio and evaporative fraction<a href="surface-energy-balance.html#hydrological-measures-bowen-ratio-and-evaporative-fraction" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The Bowen ratio <span class="math inline">\(BR\)</span> and the evaporative fraction <span class="math inline">\(EF\)</span> are given by
<span class="math display">\[
    BR:= \frac{SH}{LH}\quad\quad\textrm{and}\quad\quad EF:= \frac{LH}{LH+SH}
\]</span>
and are both a way to describe the heat transfer by sensible vs latent heat. They are related to the surface and the water abundance therein, and can be used to compare different surface types in different climates. Therefore, it is usually applied on monthly, seasonal or annual averages (so here just exemplarily calculated on daily basis).</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="surface-energy-balance.html#cb49-1" aria-hidden="true"></a><span class="kw">print</span>(<span class="kw">paste</span>(<span class="st">&quot;BR (average):&quot;</span>, <span class="kw">calc_br</span>(<span class="kw">mean</span>(dat<span class="op">$</span>sh),<span class="kw">mean</span>(dat<span class="op">$</span>lh))))</span>
<span id="cb49-2"><a href="surface-energy-balance.html#cb49-2" aria-hidden="true"></a><span class="kw">print</span>(<span class="kw">paste</span>(<span class="st">&quot;EF (average):&quot;</span>, <span class="kw">calc_ef</span>(<span class="kw">mean</span>(dat<span class="op">$</span>sh),<span class="kw">mean</span>(dat<span class="op">$</span>lh))))</span></code></pre></div>
<pre><code>[1] &quot;BR (average): 1.2715665126865&quot;
[1] &quot;EF (average): 0.440224837976387&quot;</code></pre>
</div>
<div id="meteorological-contextualization" class="section level2 hasAnchor" number="8.4">
<h2><span class="header-section-number">8.4</span> Meteorological contextualization<a href="surface-energy-balance.html#meteorological-contextualization" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>For the meteorological contextualization and related unit conversion, Reddy provides several basic function:</p>
<ul>
<li>saturation vapor pressure (<code>calc_satvaporpressure</code>)</li>
<li>vapor pressure deficit (<code>calc_vpd</code>)</li>
<li>potential temperature (<code>calc_theta</code>)</li>
<li>virtual temperature (<code>calc_Tv</code>)</li>
<li>convert pressure to height (<code>pres2height</code>)</li>
<li>convert relative to specific humidity (<code>rh2q</code>)</li>
<li>convert relative to absolute humidity (<code>rh2ah</code>)</li>
<li>convert absolute to relative humidty (<code>ah2rh</code>)</li>
<li>clear-sky index (<code>calc_csi</code>)</li>
<li>wind-related functions (<code>calc_windDirection, calc_windSpeed2D, calc_windSpeed3D, calc_gustfactor</code>)</li>
</ul>
<p>The clear-sky index is especially suitable to contextualize the surface energy balance:
The turbulent fluxes are mainly driven by the available energy through incoming solar and longwave radiation, which is in the atmosphere attenuated by clouds in a complex way, depending on cloud height and type. A way to estimate the cloud cover without directly measuring it is the clear sky-index.
Based on longwave incoming radiation, temperature and humidity, an estimate of the clear-sky-index (CSI) can be derived as ratio of actual emissivity <span class="math inline">\(\epsilon_{actual}\)</span> and theoretical (clear-sky) emissivity <span class="math inline">\(\epsilon_{theoretical}\)</span>. If <span class="math inline">\(\epsilon_{actual} \le \epsilon_{theoretical}\)</span>, i.e. <span class="math inline">\(CSI \le 1\)</span>, then the sky is assumed to be clear-sky (see e.g. the review paper <span class="citation">Lehner, Rotach, and Obleitner (<a href="#ref-Lehner2021" role="doc-biblioref">2021</a>)</span>).</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="surface-energy-balance.html#cb51-1" aria-hidden="true"></a>dat<span class="op">$</span>csi=<span class="kw">calc_csi</span>(dat<span class="op">$</span>T_mean<span class="fl">+273.15</span>,dat<span class="op">$</span>lwin,dat<span class="op">$</span>rh)</span>
<span id="cb51-2"><a href="surface-energy-balance.html#cb51-2" aria-hidden="true"></a><span class="kw">plot</span>(dat<span class="op">$</span>csi,<span class="dt">type=</span><span class="st">&quot;l&quot;</span>,<span class="dt">lwd=</span><span class="dv">2</span>,<span class="dt">ylab=</span><span class="st">&quot;CSI&quot;</span>)</span></code></pre></div>
<p><img src="figures/fig_0803.png" width="400" /></p>

</div>
</div>
<h3> References<a href="references.html#references" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="refs" class="references hanging-indent">
<div id="ref-Lehner2021">
<p>Lehner, M., E. Rotach M. W. Sfyri, and F. Obleitner. 2021. “Spatial and temporal variations in near-surface energy fluxes in an Alpine valley under synoptically undisturbed and clear-sky conditions.” <em>Q J R Meteorol Soc</em> 147 (737): 2173–96. <a href="https://doi.org/10.1002/qj.4016">https://doi.org/10.1002/qj.4016</a>.</p>
</div>
<div id="ref-Mauder2020">
<p>Mauder, M., T. Foken, and J. Cuxart. 2020. “Surface‑Energy‑Balance Closure over Land: A Review.” <em>Boundary-Layer Meteorol</em> 177: 395–426. <a href="https://doi.org/10.1007/s10546-020-00529-6">https://doi.org/10.1007/s10546-020-00529-6</a>.</p>
</div>
<div id="ref-Stoy2013">
<p>Stoy, P. C., M. Mauder, T. Foken, and et al. 2013. “A data-driven analysis of energy balance closure across FLUXNET research sites: The role of landscape scale heterogeneity.” <em>Agric Forest Meteorol</em> 171: 137–52.</p>
</div>
<div id="ref-Wilson2002">
<p>Wilson, K., and others. 2002. “Energy balance closure at FLUXNET sites.” <em>Agric Forest Meteorol</em> 113 (1-4): 223–43. <a href="https://doi.org/10.1016/S0168-1923(02)00109-0">https://doi.org/10.1016/S0168-1923(02)00109-0</a>.</p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="flux-footprint.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="references.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": null,
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "section",
"scroll_highlight": true
},
"toc depth": 2,
"github-repo": "noctiluc3nt/ec_analyze"
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
