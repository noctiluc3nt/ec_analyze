<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>2 Post-processing of raw eddy-covariance data | Reddy: An open-source package for analyzing eddy-covariance data</title>
  <meta name="description" content="2 Post-processing of raw eddy-covariance data | Reddy: An open-source package for analyzing eddy-covariance data" />
  <meta name="generator" content="bookdown 0.40 and GitBook 2.6.7" />

  <meta property="og:title" content="2 Post-processing of raw eddy-covariance data | Reddy: An open-source package for analyzing eddy-covariance data" />
  <meta property="og:type" content="book" />
  
  
  <meta name="github-repo" content="noctiluc3nt/Reddy" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="2 Post-processing of raw eddy-covariance data | Reddy: An open-source package for analyzing eddy-covariance data" />
  
  
  




  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="index.html"/>
<link rel="next" href="turbulence-diagnostics.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="https://github.com/noctiluc3nt/Reddy" target="blank"><bf>Reddy<bf></a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#measurement-setup-and-instrumentation"><i class="fa fa-check"></i><b>1.1</b> Measurement setup and instrumentation</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#data-sources"><i class="fa fa-check"></i><b>1.2</b> Data sources</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="post-processing-of-raw-eddy-covariance-data.html"><a href="post-processing-of-raw-eddy-covariance-data.html"><i class="fa fa-check"></i><b>2</b> Post-processing of raw eddy-covariance data</a>
<ul>
<li class="chapter" data-level="2.1" data-path="post-processing-of-raw-eddy-covariance-data.html"><a href="post-processing-of-raw-eddy-covariance-data.html#eddy-covariance-method"><i class="fa fa-check"></i><b>2.1</b> Eddy-covariance method</a></li>
<li class="chapter" data-level="2.2" data-path="post-processing-of-raw-eddy-covariance-data.html"><a href="post-processing-of-raw-eddy-covariance-data.html#raw-data-handling-and-corrections"><i class="fa fa-check"></i><b>2.2</b> Raw data handling and corrections</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="post-processing-of-raw-eddy-covariance-data.html"><a href="post-processing-of-raw-eddy-covariance-data.html#choosing-a-suitable-averaging-time"><i class="fa fa-check"></i><b>2.2.1</b> Choosing a suitable averaging time</a></li>
<li class="chapter" data-level="2.2.2" data-path="post-processing-of-raw-eddy-covariance-data.html"><a href="post-processing-of-raw-eddy-covariance-data.html#overview-of-correction-procedures-applied-to-the-raw-data"><i class="fa fa-check"></i><b>2.2.2</b> Overview of correction procedures applied to the raw data</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="post-processing-of-raw-eddy-covariance-data.html"><a href="post-processing-of-raw-eddy-covariance-data.html#an-example-post-processing-routine"><i class="fa fa-check"></i><b>2.3</b> An example post-processing routine</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="turbulence-diagnostics.html"><a href="turbulence-diagnostics.html"><i class="fa fa-check"></i><b>3</b> Turbulence diagnostics</a>
<ul>
<li class="chapter" data-level="3.1" data-path="turbulence-diagnostics.html"><a href="turbulence-diagnostics.html#standard-turbulence-diagnostics-and-simple-timeseries-plots"><i class="fa fa-check"></i><b>3.1</b> Standard turbulence diagnostics and simple timeseries plots</a></li>
<li class="chapter" data-level="3.2" data-path="turbulence-diagnostics.html"><a href="turbulence-diagnostics.html#stability-dependence"><i class="fa fa-check"></i><b>3.2</b> Stability dependence</a></li>
<li class="chapter" data-level="3.3" data-path="turbulence-diagnostics.html"><a href="turbulence-diagnostics.html#turbulence-regimes"><i class="fa fa-check"></i><b>3.3</b> Turbulence regimes</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="quadrant-analysis.html"><a href="quadrant-analysis.html"><i class="fa fa-check"></i><b>4</b> Quadrant Analysis</a>
<ul>
<li class="chapter" data-level="4.1" data-path="quadrant-analysis.html"><a href="quadrant-analysis.html#calculation-of-occurrence-frequencies-and-strengths-of-the-four-quadrants-with-calc_quadrant_analysis"><i class="fa fa-check"></i><b>4.1</b> Calculation of occurrence frequencies and strengths of the four quadrants with <code>calc_quadrant_analysis</code></a></li>
<li class="chapter" data-level="4.2" data-path="quadrant-analysis.html"><a href="quadrant-analysis.html#plotting-quadrant-analysis-with-plot_quadrant_analysis"><i class="fa fa-check"></i><b>4.2</b> Plotting quadrant analysis with <code>plot_quadrant_analysis</code></a></li>
<li class="chapter" data-level="4.3" data-path="quadrant-analysis.html"><a href="quadrant-analysis.html#literature"><i class="fa fa-check"></i><b>4.3</b> Literature</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="spectra.html"><a href="spectra.html"><i class="fa fa-check"></i><b>5</b> Spectra</a>
<ul>
<li class="chapter" data-level="5.1" data-path="spectra.html"><a href="spectra.html#spectral-analysis-of-timeseries"><i class="fa fa-check"></i><b>5.1</b> Spectral analysis of timeseries</a></li>
<li class="chapter" data-level="5.2" data-path="spectra.html"><a href="spectra.html#fft-spectrum-and-comparison-to-theoretical-spectra"><i class="fa fa-check"></i><b>5.2</b> FFT spectrum and comparison to theoretical spectra</a></li>
<li class="chapter" data-level="5.3" data-path="spectra.html"><a href="spectra.html#multiresolution-decomposition-mrd"><i class="fa fa-check"></i><b>5.3</b> Multiresolution decomposition (MRD)</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="spectra.html"><a href="spectra.html#calculating-multiresolution-decomposition-with-calc_mrd"><i class="fa fa-check"></i><b>5.3.1</b> Calculating multiresolution decomposition with <code>calc_mrd</code></a></li>
<li class="chapter" data-level="5.3.2" data-path="spectra.html"><a href="spectra.html#plotting-multiresolution-decomposition-with-plot_mrd"><i class="fa fa-check"></i><b>5.3.2</b> Plotting multiresolution decomposition with <code>plot_mrd</code></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="reynolds-stress-tensor.html"><a href="reynolds-stress-tensor.html"><i class="fa fa-check"></i><b>6</b> Reynolds stress tensor</a>
<ul>
<li class="chapter" data-level="6.1" data-path="reynolds-stress-tensor.html"><a href="reynolds-stress-tensor.html#invariant-analysis-of-the-reynolds-stress-tensor"><i class="fa fa-check"></i><b>6.1</b> Invariant analysis of the Reynolds stress tensor</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="reynolds-stress-tensor.html"><a href="reynolds-stress-tensor.html#performing-the-invariant-analysis-of-the-reynolds-stress-tensor-with-calc_anisotropy"><i class="fa fa-check"></i><b>6.1.1</b> Performing the invariant analysis of the Reynolds stress tensor with <code>calc_anisotropy</code></a></li>
<li class="chapter" data-level="6.1.2" data-path="reynolds-stress-tensor.html"><a href="reynolds-stress-tensor.html#plotting-the-barycentric-map-using-plot_barycentric_map"><i class="fa fa-check"></i><b>6.1.2</b> Plotting the barycentric map using <code>plot_barycentric_map</code></a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="reynolds-stress-tensor.html"><a href="reynolds-stress-tensor.html#anisotropy-and-velocity-aspect-ratio-var"><i class="fa fa-check"></i><b>6.2</b> Anisotropy and velocity aspect ratio (VAR)</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="flux-footprint.html"><a href="flux-footprint.html"><i class="fa fa-check"></i><b>7</b> Flux footprint</a>
<ul>
<li class="chapter" data-level="7.1" data-path="flux-footprint.html"><a href="flux-footprint.html#flux-footprint-parametrizations"><i class="fa fa-check"></i><b>7.1</b> Flux footprint parametrizations</a></li>
<li class="chapter" data-level="7.2" data-path="flux-footprint.html"><a href="flux-footprint.html#d-flux-footprint-estimate"><i class="fa fa-check"></i><b>7.2</b> 2D flux footprint estimate</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="flux-footprint.html"><a href="flux-footprint.html#calculate-2d-flux-footprint-estimate-with-calc_flux_footprint"><i class="fa fa-check"></i><b>7.2.1</b> Calculate 2D flux footprint estimate with <code>calc_flux_footprint</code></a></li>
<li class="chapter" data-level="7.2.2" data-path="flux-footprint.html"><a href="flux-footprint.html#plotting-of-flux-footprint-with-plot_flux_footprint"><i class="fa fa-check"></i><b>7.2.2</b> Plotting of flux footprint with <code>plot_flux_footprint</code></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="surface-energy-balance.html"><a href="surface-energy-balance.html"><i class="fa fa-check"></i><b>8</b> Surface energy balance</a>
<ul>
<li class="chapter" data-level="8.1" data-path="surface-energy-balance.html"><a href="surface-energy-balance.html#surface-energy-balance-closure"><i class="fa fa-check"></i><b>8.1</b> Surface energy balance closure</a></li>
<li class="chapter" data-level="8.2" data-path="surface-energy-balance.html"><a href="surface-energy-balance.html#calculating-surface-energy-balance"><i class="fa fa-check"></i><b>8.2</b> Calculating surface energy balance</a></li>
<li class="chapter" data-level="8.3" data-path="surface-energy-balance.html"><a href="surface-energy-balance.html#bowen-ratio-and-evaporative-fraction"><i class="fa fa-check"></i><b>8.3</b> Bowen ratio and evaporative fraction</a></li>
<li class="chapter" data-level="8.4" data-path="surface-energy-balance.html"><a href="surface-energy-balance.html#clear-sky-index-csi-for-contextualization-calc_csi"><i class="fa fa-check"></i><b>8.4</b> Clear-Sky-Index (CSI) for contextualization (<code>calc_csi</code>)</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://bookdown.org" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Reddy: An open-source package for analyzing eddy-covariance data</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="post-processing-of-raw-eddy-covariance-data" class="section level1 hasAnchor" number="2">
<h1><span class="header-section-number">2</span> Post-processing of raw eddy-covariance data<a href="post-processing-of-raw-eddy-covariance-data.html#post-processing-of-raw-eddy-covariance-data" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>To derive turbulent fluxes and other turbulence characteristics from eddy-covariance measurements, they have to be post-processed first. In the following, we will have a look a the required steps – starting with the theoretical foundation of the method and the necessary physical and technical considerations for the raw data processing. The upcoming analysis (e.g., <a href="https://github.com/noctiluc3nt/ec_analyze/blob/main/notebooks/02_basic-turbulence-diagnostics.ipynb">02_basic-turbulence-diagnostics.ipynb</a>) build upon this and allow for a more detailed analysis (e.g., <a href="https://github.com/noctiluc3nt/ec_analyze/blob/main/notebooks/03_quadrant-analysis.ipynb">03_quadrant-analysis.ipynb</a>).</p>
<div id="eddy-covariance-method" class="section level2 hasAnchor" number="2.1">
<h2><span class="header-section-number">2.1</span> Eddy-covariance method<a href="post-processing-of-raw-eddy-covariance-data.html#eddy-covariance-method" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>How do we derive a flux from the sonic measurements? The eddy-covariance method is based on the Reynolds decomposition, which is applied to every measured quantity <span class="math inline">\(x\)</span> through
<span class="math display">\[
x = \overline{x} + x&#39; \quad \textrm{with} \quad \overline{x}:= \frac{1}{t_s} \int_0^{t_s} x \: dt.
\]</span>
Therein, <span class="math inline">\(\overline{x}\)</span> represents the time average and <span class="math inline">\(x&#39;\)</span> the deviation from it. In principle, one would have to consider the ensemble average (i.e., all possible path in the phase space), but this is replaced by the time average assuming ergodicity. Now, we take a look at the flux, which is defined as the average product of two quantities <span class="math inline">\(\overline{xw}\)</span>, and insert the Reynolds decomposition:
<span class="math display">\[
    \overline{xw} = \overline{x}\:\overline{w} + \overline{x}\overline{w&#39;} + \overline{x&#39;}\overline{w} + \overline{x&#39;w&#39;} = \overline{x}\:\overline{w} + \overline{x&#39;w&#39;}
\]</span>
The second and third term vanish because of the Reynolds postulates (i.e. <span class="math inline">\(\overline{x&#39;} = 0\)</span>). If additionally <span class="math inline">\(\overline{w}=0\)</span>, the flux can be represented by the correlation, i.e., <span class="math inline">\(\overline{xw} = \overline{x&#39;w&#39;}\)</span>. As you see, this procedure involves a lot of assumptions: For <span class="math inline">\(\overline{x&#39;} = 0\)</span> to be true, we assume that the flow is steady and for <span class="math inline">\(\overline{w}=0\)</span> you either have a homogeneous and flat surface or you need to rotate the sonic coordiante system (see the correction methods below). <br>
Usually, <span class="math inline">\(w\)</span> represents the vertical wind speed and <span class="math inline">\(x\)</span> can be an arbitrary scalar quantity. For the momentum flux, we use <span class="math inline">\(x=u\)</span> (streamwise velocity), for the sensible heat flux <span class="math inline">\(x=T\)</span> (temperature or potential temperature), for the latent heat flux <span class="math inline">\(x=q\)</span> (specific humidity) and for trace gas fluxes <span class="math inline">\(x=c\)</span> (the concentration of the respective trace gas).</p>
</div>
<div id="raw-data-handling-and-corrections" class="section level2 hasAnchor" number="2.2">
<h2><span class="header-section-number">2.2</span> Raw data handling and corrections<a href="post-processing-of-raw-eddy-covariance-data.html#raw-data-handling-and-corrections" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>For applying the described eddy-covariance method to the measurements, we have to decide on an averaging time <span class="math inline">\(t_s\)</span>, have to perform quality control of the raw data and have to check the fulfillment of the made assumptions.</p>
<div id="choosing-a-suitable-averaging-time" class="section level3 hasAnchor" number="2.2.1">
<h3><span class="header-section-number">2.2.1</span> Choosing a suitable averaging time<a href="post-processing-of-raw-eddy-covariance-data.html#choosing-a-suitable-averaging-time" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>As we have seen above, for calculating the fluxes with the eddy-covariance method, a suitable averaging time (<span class="math inline">\(t_s\)</span>) should be chosen. For this several things need to be considered: Generally, one can say that the longer the averaging time, the less likely it is that the conditions are steady (which is an assumption in the EC method), but short averaging times lose low frequency contributions. So usually, an averaging time of 30 minutes is chosen. However, this averaging time can still be too long if the turbulence is very intermittent, which is the case for very stable conditions. Consequently, some studies use the 30 minutes average just for unstable stratification and an averaging time of 1 to 10 minutes for stable conditions. It is recommendable to first study the characteristics of the sampled raw data (e.g., based on spectra) and then chose an averaging time.<br></p>
</div>
<div id="overview-of-correction-procedures-applied-to-the-raw-data" class="section level3 hasAnchor" number="2.2.2">
<h3><span class="header-section-number">2.2.2</span> Overview of correction procedures applied to the raw data<a href="post-processing-of-raw-eddy-covariance-data.html#overview-of-correction-procedures-applied-to-the-raw-data" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li><strong>Despiking</strong> (<code>despiking</code>): Removing of spikes in the raw data. For this usually three methods are applied: (1) based on pre-defined thresholds (i.e., an expected temperature or wind speed interval), (2) median deviation (MAD) test, i.e., all measurements lie within a pre-defined range around the median, and (3) based on skewness (3. moment) and kurtosis (4. moment), i.e., the skewness and kurtosis of the considered interval do not exceed pre-defined values.</li>
<li><strong>Lag-time correction</strong> (<code>shift2maxccf</code>): Lag-time can occur if several loggers are used or the inlet tube of the gas analyzer is very long, such that there is a time offset between the different measured variables. This can be corrected by calculating the maximum cross-correlation and shift the time series according to the lag difference, which is done by the function <code>shift2maxccf</code>.</li>
<li><strong>Detrending</strong> (<code>pracma::detrending</code>): Linear detrending by substracting the mean value (however, linear detrending is not consistent with Reynolds decomposition, so it should be used/interpreted with caution).</li>
<li><strong>Rotation</strong> (<code>rotate_double</code> or <code>rotate_planar</code>): Rotation of the sonic coordinate system. Since the orientation of the sonic is arbitrary, the measurements have to be interpreted in a suitable coordinate system. For this the natural coordinate systems is used, which means that it follows the streamlines and the coordinates are then given by the streamwise velocity component <span class="math inline">\(u\)</span>, the crosswise velocity component <span class="math inline">\(v\)</span> and the vertical velocity component <span class="math inline">\(w\)</span>. To determine the orientation, two main approaches exist: Double rotation (<code>rotate_double</code>) alignes the sonic coordinate system with the streamlines for every averaging interval. Hence, this method can be applied near-real time. Planar fit rotation (<code>rotate_planar</code>) aligns the sonic coordinate system with the mean streamlines under the conditions that the mean vertical velocity <span class="math inline">\(\overline{w}\)</span> vanishes. For this, a time series is required and thus near-real time processing not possible. Generally, it is recommended to use double rotation in relatively simple topography, but planar fit in complex (micro-)topogaphy. The angles around which the sonic coordinate system was rotated also allow to estimate the quality of the measurements (the smaller the angle of rotation, the better and important is that they do not flip signs, in particular for close-to-zero fluxes under very stable stratification).</li>
<li><strong>Quality flagging</strong> (<code>stationarity_flag</code>,<code>flag_w</code>,<code>flag_distortion</code>,<code>flag_most</code>): Several quality flags (ranging from 0: the best to 2: the worst) can be applied. Common flags are: a stationarity flag (<code>stationarity_flag</code>), that test the alignment with the stationarity assumption of the eddy-covariance method, a vertical velocity flag (<code>flag_w</code>), which checks that remaining vertical velocity after the rotation is small, a flow distortion flag (<code>flag_distortion</code>), which removes the pre-defined wind directions that are possibly affected/blocked by the mast, an integral turbulence characteristics flag (<code>flag_itc</code>), which test for the agreement with Monin-Obukhov similarity theory. However, these flags have to be applied purpose-oriented and interpreted with caution. Sometimes particularly “poorly flagged” measurements are interesting for investigating turbulence under challenging (and therefore interesting) conditions, e.g. under very stable stratification.</li>
<li><strong>SND (and cross-wind) correction</strong> (<code>SNDcorrection</code>): Converts the buoyancy flux to sensible heat flux. Since most sonics measure the sound propagation speed, the measured temperature (the so called sonic temperature <span class="math inline">\(T_s\)</span>) is similar to the virtual temperature and thus the resulting flux <span class="math inline">\(\overline{w&#39;T_s&#39;}\)</span> represents the buoyancy flux, which is about 10-20 % larger than the sensible heat flux <span class="math inline">\(\overline{w&#39;T&#39;}\)</span>. Note, the used constants in the method depend on the measurement device (default for CSAT3).</li>
<li><strong>WPL correction</strong> (<code>WPLcorrection</code>): Converts volume- to mass-related quantities for trace gas fluxes. This correction only applies to trace gas concentration (water vapor, carbon dioxide, methane, …) measured with a gas analyzer.</li>
<li><strong>Unit conversion (density)</strong> (<code>ppt2rho</code>): Converts ppt to density. Closed-path gas analyzers measure trace gas concentrations in parts-per-… (ppt: … thousand, ppm: … million), which has to be converted to a density based on the respective molar mass.</li>
<li><strong>Unit conversion (fluxes)</strong> (<code>cov2sh</code>, <code>cov2lh</code>): Converts covariances to the respective flux in W/m<span class="math inline">\(^2\)</span>, i.e., cov(w,T) to sensible heat flux and cov(w,q) to latent heat flux.</li>
</ul>
<p>There are more (and partly controversial) correction methods, details are discussed in <span class="citation">Foken (<a href="#ref-Foken2017" role="doc-biblioref">2017</a>)</span>. Further correction methods are required when spectra are considered (spectral corrections) or budgets are calculated (gap-filling of missing values, to avoid a bias due to the discarded data).</p>
</div>
</div>
<div id="an-example-post-processing-routine" class="section level2 hasAnchor" number="2.3">
<h2><span class="header-section-number">2.3</span> An example post-processing routine<a href="post-processing-of-raw-eddy-covariance-data.html#an-example-post-processing-routine" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Now, we create an example post-processing routine. For this, we use 3 days of raw eddy-covariance measurements (CSAT3/Campbell Scientific and Li-7200/LI-COR closed-path IR gas analyzer) with a 10 Hz sampling frequency from our station in Finse, Hardangervidda, Norway.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="post-processing-of-raw-eddy-covariance-data.html#cb1-1" aria-hidden="true"></a><span class="co">#loading Reddy package</span></span>
<span id="cb1-2"><a href="post-processing-of-raw-eddy-covariance-data.html#cb1-2" aria-hidden="true"></a><span class="kw">install.packages</span>(<span class="st">&quot;../src/Reddy_0.0.0.9000.tar.gz&quot;</span>,<span class="dt">repos=</span><span class="ot">NULL</span>,<span class="dt">source=</span><span class="ot">TRUE</span>)</span>
<span id="cb1-3"><a href="post-processing-of-raw-eddy-covariance-data.html#cb1-3" aria-hidden="true"></a><span class="kw">library</span>(Reddy)</span></code></pre></div>
<pre><code>Installing package into ‘/home/lauracma/R/x86_64-pc-linux-gnu-library/4.0’
(as ‘lib’ is unspecified)</code></pre>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="post-processing-of-raw-eddy-covariance-data.html#cb3-1" aria-hidden="true"></a><span class="co">#ec data files</span></span>
<span id="cb3-2"><a href="post-processing-of-raw-eddy-covariance-data.html#cb3-2" aria-hidden="true"></a>dir_in=<span class="st">&quot;../data/ec-data_10Hz_raw&quot;</span></span>
<span id="cb3-3"><a href="post-processing-of-raw-eddy-covariance-data.html#cb3-3" aria-hidden="true"></a>files=<span class="kw">list.files</span>(dir_in,<span class="dt">full.names=</span><span class="ot">TRUE</span>)</span>
<span id="cb3-4"><a href="post-processing-of-raw-eddy-covariance-data.html#cb3-4" aria-hidden="true"></a>nf=<span class="kw">length</span>(files)</span></code></pre></div>
<p>Each given file contains 30 minutes of measurements, such that we just need to average over one file to get the 30 minutes averages and fluxes. In the notebook <a href="https://github.com/noctiluc3nt/ec_analyze/blob/main/notebooks/04_multiresolution-decomposition.ipynb">04_multiresolution-decomposition.ipynb</a> we will have a look at method that allows to determine suitable averaging times more accurately. The data is first despiked, than the wind is rotated and the sonic measurements are averaged. For the gas analyzer measurements, the unit is converted to a density. Then the turbulence intensities (standard deviation) and the fluxes (covariances) are calculated. For the sensible heat flux, we need to apply the SND correction additionally, the WPL correction can be applied to the latent heat flux.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="post-processing-of-raw-eddy-covariance-data.html#cb4-1" aria-hidden="true"></a><span class="co">#allocate output</span></span>
<span id="cb4-2"><a href="post-processing-of-raw-eddy-covariance-data.html#cb4-2" aria-hidden="true"></a>var_out=<span class="kw">c</span>(<span class="st">&quot;time&quot;</span>,<span class="st">&quot;u_mean&quot;</span>,<span class="st">&quot;v_mean&quot;</span>,<span class="st">&quot;w_mean&quot;</span>,<span class="st">&quot;ws_mean&quot;</span>,<span class="st">&quot;wd_mean&quot;</span>,<span class="st">&quot;T_mean&quot;</span>,<span class="st">&quot;h2o_mean&quot;</span>,<span class="st">&quot;co2_mean&quot;</span>,</span>
<span id="cb4-3"><a href="post-processing-of-raw-eddy-covariance-data.html#cb4-3" aria-hidden="true"></a>          <span class="st">&quot;u_sd&quot;</span>,<span class="st">&quot;v_sd&quot;</span>,<span class="st">&quot;w_sd&quot;</span>,<span class="st">&quot;T_sd&quot;</span>,<span class="st">&quot;h2o_sd&quot;</span>,<span class="st">&quot;co2_sd&quot;</span>,</span>
<span id="cb4-4"><a href="post-processing-of-raw-eddy-covariance-data.html#cb4-4" aria-hidden="true"></a>          <span class="st">&quot;cov_uv&quot;</span>,<span class="st">&quot;cov_uw&quot;</span>,<span class="st">&quot;cov_vw&quot;</span>,<span class="st">&quot;cov_wT&quot;</span>,<span class="st">&quot;cov_h2ow&quot;</span>,<span class="st">&quot;cov_co2w&quot;</span>,<span class="st">&quot;cov_wT_snd&quot;</span>,<span class="st">&quot;cov_rhoH2Ow_wpl&quot;</span>,</span>
<span id="cb4-5"><a href="post-processing-of-raw-eddy-covariance-data.html#cb4-5" aria-hidden="true"></a>          <span class="st">&quot;rot_angle1&quot;</span>,<span class="st">&quot;rot_angle2&quot;</span>,<span class="st">&quot;flag_stationarity&quot;</span>,<span class="st">&quot;flag_w&quot;</span>,<span class="st">&quot;flag_distortion&quot;</span>)</span>
<span id="cb4-6"><a href="post-processing-of-raw-eddy-covariance-data.html#cb4-6" aria-hidden="true"></a>nv=<span class="kw">length</span>(var_out)</span>
<span id="cb4-7"><a href="post-processing-of-raw-eddy-covariance-data.html#cb4-7" aria-hidden="true"></a>dat=<span class="kw">data.frame</span>(<span class="kw">array</span>(<span class="ot">NA</span>,<span class="dt">dim=</span><span class="kw">c</span>(nf,nv)))</span>
<span id="cb4-8"><a href="post-processing-of-raw-eddy-covariance-data.html#cb4-8" aria-hidden="true"></a><span class="kw">colnames</span>(dat)=var_out</span></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="post-processing-of-raw-eddy-covariance-data.html#cb5-1" aria-hidden="true"></a><span class="co">#postprocessing per file (30 mins)</span></span>
<span id="cb5-2"><a href="post-processing-of-raw-eddy-covariance-data.html#cb5-2" aria-hidden="true"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>nf) {</span>
<span id="cb5-3"><a href="post-processing-of-raw-eddy-covariance-data.html#cb5-3" aria-hidden="true"></a>    tmp=<span class="kw">read.table</span>(files[i],<span class="dt">sep=</span><span class="st">&quot;,&quot;</span>,<span class="dt">header=</span>T)</span>
<span id="cb5-4"><a href="post-processing-of-raw-eddy-covariance-data.html#cb5-4" aria-hidden="true"></a>    dat<span class="op">$</span>time[i]=tmp<span class="op">$</span>X[<span class="dv">1</span>]</span>
<span id="cb5-5"><a href="post-processing-of-raw-eddy-covariance-data.html#cb5-5" aria-hidden="true"></a>    <span class="co">#despiking</span></span>
<span id="cb5-6"><a href="post-processing-of-raw-eddy-covariance-data.html#cb5-6" aria-hidden="true"></a>    tmp<span class="op">$</span>T_degC=<span class="kw">despiking</span>(tmp<span class="op">$</span>T_degC,<span class="op">-</span><span class="dv">40</span>,<span class="dv">30</span>)</span>
<span id="cb5-7"><a href="post-processing-of-raw-eddy-covariance-data.html#cb5-7" aria-hidden="true"></a>    tmp<span class="op">$</span>u_m.s=<span class="kw">despiking</span>(tmp<span class="op">$</span>u_m.s,<span class="op">-</span><span class="dv">25</span>,<span class="dv">25</span>)</span>
<span id="cb5-8"><a href="post-processing-of-raw-eddy-covariance-data.html#cb5-8" aria-hidden="true"></a>    tmp<span class="op">$</span>v_m.s=<span class="kw">despiking</span>(tmp<span class="op">$</span>v_m.s,<span class="op">-</span><span class="dv">25</span>,<span class="dv">25</span>)</span>
<span id="cb5-9"><a href="post-processing-of-raw-eddy-covariance-data.html#cb5-9" aria-hidden="true"></a>    tmp<span class="op">$</span>w_m.s=<span class="kw">despiking</span>(tmp<span class="op">$</span>w_m.s,<span class="op">-</span><span class="dv">5</span>,<span class="dv">5</span>)</span>
<span id="cb5-10"><a href="post-processing-of-raw-eddy-covariance-data.html#cb5-10" aria-hidden="true"></a>    <span class="co">#wind before rotation</span></span>
<span id="cb5-11"><a href="post-processing-of-raw-eddy-covariance-data.html#cb5-11" aria-hidden="true"></a>    dat<span class="op">$</span>ws_mean[i]=<span class="kw">sqrt</span>(<span class="kw">mean</span>(tmp<span class="op">$</span>u_m.s,<span class="dt">na.rm=</span>T)<span class="op">^</span><span class="dv">2</span><span class="op">+</span><span class="kw">mean</span>(tmp<span class="op">$</span>v_m.s,<span class="dt">na.rm=</span>T)<span class="op">^</span><span class="dv">2</span>)</span>
<span id="cb5-12"><a href="post-processing-of-raw-eddy-covariance-data.html#cb5-12" aria-hidden="true"></a>    dat<span class="op">$</span>wd_mean[i]=<span class="kw">atan2</span>(<span class="kw">mean</span>(tmp<span class="op">$</span>v_m.s,<span class="dt">na.rm=</span>T),<span class="kw">mean</span>(tmp<span class="op">$</span>u_m.s,<span class="dt">na.rm=</span>T))</span>
<span id="cb5-13"><a href="post-processing-of-raw-eddy-covariance-data.html#cb5-13" aria-hidden="true"></a>    <span class="co">#rotation</span></span>
<span id="cb5-14"><a href="post-processing-of-raw-eddy-covariance-data.html#cb5-14" aria-hidden="true"></a>    rot_wind=<span class="kw">rotate_double</span>(tmp<span class="op">$</span>u_m.s,tmp<span class="op">$</span>v_m.s,tmp<span class="op">$</span>w_m.s)</span>
<span id="cb5-15"><a href="post-processing-of-raw-eddy-covariance-data.html#cb5-15" aria-hidden="true"></a>    tmp<span class="op">$</span>u_m.s=rot_wind<span class="op">$</span>u</span>
<span id="cb5-16"><a href="post-processing-of-raw-eddy-covariance-data.html#cb5-16" aria-hidden="true"></a>    tmp<span class="op">$</span>v_m.s=rot_wind<span class="op">$</span>v</span>
<span id="cb5-17"><a href="post-processing-of-raw-eddy-covariance-data.html#cb5-17" aria-hidden="true"></a>    tmp<span class="op">$</span>w_m.s=rot_wind<span class="op">$</span>w</span>
<span id="cb5-18"><a href="post-processing-of-raw-eddy-covariance-data.html#cb5-18" aria-hidden="true"></a>    dat<span class="op">$</span>rot_angle1[i]=rot_wind<span class="op">$</span>theta</span>
<span id="cb5-19"><a href="post-processing-of-raw-eddy-covariance-data.html#cb5-19" aria-hidden="true"></a>    dat<span class="op">$</span>rot_angle2[i]=rot_wind<span class="op">$</span>phi</span>
<span id="cb5-20"><a href="post-processing-of-raw-eddy-covariance-data.html#cb5-20" aria-hidden="true"></a>    <span class="co">#averaging</span></span>
<span id="cb5-21"><a href="post-processing-of-raw-eddy-covariance-data.html#cb5-21" aria-hidden="true"></a>    dat<span class="op">$</span>u_mean[i]=<span class="kw">mean</span>(tmp<span class="op">$</span>u_m.s,<span class="dt">na.rm=</span>T)</span>
<span id="cb5-22"><a href="post-processing-of-raw-eddy-covariance-data.html#cb5-22" aria-hidden="true"></a>    dat<span class="op">$</span>v_mean[i]=<span class="kw">mean</span>(tmp<span class="op">$</span>v_m.s,<span class="dt">na.rm=</span>T)</span>
<span id="cb5-23"><a href="post-processing-of-raw-eddy-covariance-data.html#cb5-23" aria-hidden="true"></a>    dat<span class="op">$</span>w_mean[i]=<span class="kw">mean</span>(tmp<span class="op">$</span>w_m.s,<span class="dt">na.rm=</span>T)</span>
<span id="cb5-24"><a href="post-processing-of-raw-eddy-covariance-data.html#cb5-24" aria-hidden="true"></a>    dat<span class="op">$</span>T_mean[i]=<span class="kw">mean</span>(tmp<span class="op">$</span>T_degC,<span class="dt">na.rm=</span>T)</span>
<span id="cb5-25"><a href="post-processing-of-raw-eddy-covariance-data.html#cb5-25" aria-hidden="true"></a>    <span class="co">#unit conversion for gases</span></span>
<span id="cb5-26"><a href="post-processing-of-raw-eddy-covariance-data.html#cb5-26" aria-hidden="true"></a>    tmp<span class="op">$</span>rhoH2O=<span class="kw">ppt2rho</span>(tmp<span class="op">$</span>H2O_ppt,dat<span class="op">$</span>T_mean[i]<span class="op">+</span><span class="fl">273.15</span>,<span class="dv">87000</span>)</span>
<span id="cb5-27"><a href="post-processing-of-raw-eddy-covariance-data.html#cb5-27" aria-hidden="true"></a>    tmp<span class="op">$</span>rhoCO2=<span class="kw">ppt2rho</span>(tmp<span class="op">$</span>CO2_ppm<span class="op">/</span><span class="dv">1000</span>,dat<span class="op">$</span>T_mean[i]<span class="op">+</span><span class="fl">273.15</span>,<span class="dv">87000</span>,<span class="dt">gas=</span><span class="st">&quot;CO2&quot;</span>)</span>
<span id="cb5-28"><a href="post-processing-of-raw-eddy-covariance-data.html#cb5-28" aria-hidden="true"></a>    dat<span class="op">$</span>h2o_mean[i]=<span class="kw">mean</span>(tmp<span class="op">$</span>rhoH2O,<span class="dt">na.rm=</span>T)</span>
<span id="cb5-29"><a href="post-processing-of-raw-eddy-covariance-data.html#cb5-29" aria-hidden="true"></a>    dat<span class="op">$</span>co2_mean[i]=<span class="kw">mean</span>(tmp<span class="op">$</span>rhoCO2,<span class="dt">na.rm=</span>T)</span>
<span id="cb5-30"><a href="post-processing-of-raw-eddy-covariance-data.html#cb5-30" aria-hidden="true"></a>    <span class="co">#sds</span></span>
<span id="cb5-31"><a href="post-processing-of-raw-eddy-covariance-data.html#cb5-31" aria-hidden="true"></a>    dat<span class="op">$</span>u_sd[i]=<span class="kw">sd</span>(tmp<span class="op">$</span>u_m.s,<span class="dt">na.rm=</span>T)</span>
<span id="cb5-32"><a href="post-processing-of-raw-eddy-covariance-data.html#cb5-32" aria-hidden="true"></a>    dat<span class="op">$</span>v_sd[i]=<span class="kw">sd</span>(tmp<span class="op">$</span>v_m.s,<span class="dt">na.rm=</span>T)</span>
<span id="cb5-33"><a href="post-processing-of-raw-eddy-covariance-data.html#cb5-33" aria-hidden="true"></a>    dat<span class="op">$</span>w_sd[i]=<span class="kw">sd</span>(tmp<span class="op">$</span>w_m.s,<span class="dt">na.rm=</span>T)</span>
<span id="cb5-34"><a href="post-processing-of-raw-eddy-covariance-data.html#cb5-34" aria-hidden="true"></a>    dat<span class="op">$</span>T_sd[i]=<span class="kw">sd</span>(tmp<span class="op">$</span>T_degC,<span class="dt">na.rm=</span>T)</span>
<span id="cb5-35"><a href="post-processing-of-raw-eddy-covariance-data.html#cb5-35" aria-hidden="true"></a>    dat<span class="op">$</span>h2o_sd[i]=<span class="kw">sd</span>(tmp<span class="op">$</span>rhoH2O,<span class="dt">na.rm=</span>T)</span>
<span id="cb5-36"><a href="post-processing-of-raw-eddy-covariance-data.html#cb5-36" aria-hidden="true"></a>    dat<span class="op">$</span>co2_sd[i]=<span class="kw">sd</span>(tmp<span class="op">$</span>rhoCO2,<span class="dt">na.rm=</span>T)</span>
<span id="cb5-37"><a href="post-processing-of-raw-eddy-covariance-data.html#cb5-37" aria-hidden="true"></a>    <span class="co">#covs</span></span>
<span id="cb5-38"><a href="post-processing-of-raw-eddy-covariance-data.html#cb5-38" aria-hidden="true"></a>    dat<span class="op">$</span>cov_uw[i]=<span class="kw">cov</span>(tmp<span class="op">$</span>u_m.s,tmp<span class="op">$</span>w_m.s,<span class="dt">use=</span><span class="st">&quot;pairwise.complete.obs&quot;</span>)</span>
<span id="cb5-39"><a href="post-processing-of-raw-eddy-covariance-data.html#cb5-39" aria-hidden="true"></a>    dat<span class="op">$</span>cov_uv[i]=<span class="kw">cov</span>(tmp<span class="op">$</span>u_m.s,tmp<span class="op">$</span>v_m.s,<span class="dt">use=</span><span class="st">&quot;pairwise.complete.obs&quot;</span>)</span>
<span id="cb5-40"><a href="post-processing-of-raw-eddy-covariance-data.html#cb5-40" aria-hidden="true"></a>    dat<span class="op">$</span>cov_vw[i]=<span class="kw">cov</span>(tmp<span class="op">$</span>v_m.s,tmp<span class="op">$</span>w_m.s,<span class="dt">use=</span><span class="st">&quot;pairwise.complete.obs&quot;</span>)</span>
<span id="cb5-41"><a href="post-processing-of-raw-eddy-covariance-data.html#cb5-41" aria-hidden="true"></a>    dat<span class="op">$</span>cov_wT[i]=<span class="kw">cov</span>(tmp<span class="op">$</span>T_degC,tmp<span class="op">$</span>w_m.s,<span class="dt">use=</span><span class="st">&quot;pairwise.complete.obs&quot;</span>)</span>
<span id="cb5-42"><a href="post-processing-of-raw-eddy-covariance-data.html#cb5-42" aria-hidden="true"></a>    dat<span class="op">$</span>cov_h2ow[i]=<span class="kw">cov</span>(tmp<span class="op">$</span>rhoH2O,tmp<span class="op">$</span>w_m.s,<span class="dt">use=</span><span class="st">&quot;pairwise.complete.obs&quot;</span>)</span>
<span id="cb5-43"><a href="post-processing-of-raw-eddy-covariance-data.html#cb5-43" aria-hidden="true"></a>    dat<span class="op">$</span>cov_co2w[i]=<span class="kw">cov</span>(tmp<span class="op">$</span>rhoCO2,tmp<span class="op">$</span>w_m.s,<span class="dt">use=</span><span class="st">&quot;pairwise.complete.obs&quot;</span>)</span>
<span id="cb5-44"><a href="post-processing-of-raw-eddy-covariance-data.html#cb5-44" aria-hidden="true"></a>    <span class="co">#SND correction</span></span>
<span id="cb5-45"><a href="post-processing-of-raw-eddy-covariance-data.html#cb5-45" aria-hidden="true"></a>    dat<span class="op">$</span>cov_wT_snd[i]=<span class="kw">SNDcorrection</span>(tmp<span class="op">$</span>u_m.s,tmp<span class="op">$</span>v_m.s,tmp<span class="op">$</span>w_m.s,tmp<span class="op">$</span>T_degC<span class="fl">+273.15</span>)</span>
<span id="cb5-46"><a href="post-processing-of-raw-eddy-covariance-data.html#cb5-46" aria-hidden="true"></a>    <span class="co">#WPL correction</span></span>
<span id="cb5-47"><a href="post-processing-of-raw-eddy-covariance-data.html#cb5-47" aria-hidden="true"></a>    <span class="co">#dat$cov_rhoH2Ow_wpl[i]=WPLcorrection(tmp$rhoH2O,w=tmp$w_m.s,Ts=tmp$T_degC+273.15,q=tmp$q)</span></span>
<span id="cb5-48"><a href="post-processing-of-raw-eddy-covariance-data.html#cb5-48" aria-hidden="true"></a>    <span class="co">#flagging</span></span>
<span id="cb5-49"><a href="post-processing-of-raw-eddy-covariance-data.html#cb5-49" aria-hidden="true"></a>    dat<span class="op">$</span>flag_stationarity[i]=<span class="kw">flag_stationarity</span>(tmp<span class="op">$</span>w_m.s,tmp<span class="op">$</span>T_degC,<span class="dt">nsub=</span><span class="dv">3000</span>)</span>
<span id="cb5-50"><a href="post-processing-of-raw-eddy-covariance-data.html#cb5-50" aria-hidden="true"></a>    dat<span class="op">$</span>flag_w[i]=<span class="kw">flag_w</span>(dat<span class="op">$</span>w_mean[i])</span>
<span id="cb5-51"><a href="post-processing-of-raw-eddy-covariance-data.html#cb5-51" aria-hidden="true"></a>    dat<span class="op">$</span>flag_distortion[i]=<span class="kw">flag_distortion</span>(tmp<span class="op">$</span>u_m.s,tmp<span class="op">$</span>v_m.s,<span class="dt">dir_blocked=</span><span class="kw">c</span>(<span class="dv">340</span>,<span class="dv">360</span>))</span>
<span id="cb5-52"><a href="post-processing-of-raw-eddy-covariance-data.html#cb5-52" aria-hidden="true"></a>}</span></code></pre></div>
<p>The calculated covariances have to be converted to the fluxes (unit W/m<span class="math inline">\(^2\)</span>), for example with the functions <code>cov2sh</code>and <code>cov2lh</code>:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="post-processing-of-raw-eddy-covariance-data.html#cb6-1" aria-hidden="true"></a><span class="co">#calculate fluxes</span></span>
<span id="cb6-2"><a href="post-processing-of-raw-eddy-covariance-data.html#cb6-2" aria-hidden="true"></a>dat<span class="op">$</span>sh=<span class="kw">cov2sh</span>(dat<span class="op">$</span>cov_wT_snd)</span>
<span id="cb6-3"><a href="post-processing-of-raw-eddy-covariance-data.html#cb6-3" aria-hidden="true"></a>dat<span class="op">$</span>lh=<span class="kw">cov2lh</span>(dat<span class="op">$</span>cov_h2ow)</span></code></pre></div>
<p>The output now contains the 30 minutes averages, standard deviations and covariances of the measured quantities, which will be used in the following notebooks for some more detailed analysis.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="post-processing-of-raw-eddy-covariance-data.html#cb7-1" aria-hidden="true"></a><span class="co">#look at output</span></span>
<span id="cb7-2"><a href="post-processing-of-raw-eddy-covariance-data.html#cb7-2" aria-hidden="true"></a><span class="kw">head</span>(dat)</span></code></pre></div>
<table class="dataframe">
<caption>
A data.frame: 6 × 30
</caption>
<thead>
<tr>
<th>
</th>
<th scope="col">
time
</th>
<th scope="col">
u_mean
</th>
<th scope="col">
v_mean
</th>
<th scope="col">
w_mean
</th>
<th scope="col">
ws_mean
</th>
<th scope="col">
wd_mean
</th>
<th scope="col">
T_mean
</th>
<th scope="col">
h2o_mean
</th>
<th scope="col">
co2_mean
</th>
<th scope="col">
u_sd
</th>
<th scope="col">
⋯
</th>
<th scope="col">
cov_co2w
</th>
<th scope="col">
cov_wT_snd
</th>
<th scope="col">
cov_rhoH2Ow_wpl
</th>
<th scope="col">
rot_angle1
</th>
<th scope="col">
rot_angle2
</th>
<th scope="col">
flag_stationarity
</th>
<th scope="col">
flag_w
</th>
<th scope="col">
flag_distortion
</th>
<th scope="col">
sh
</th>
<th scope="col">
lh
</th>
</tr>
<tr>
<th>
</th>
<th scope="col">
&lt;chr&gt;
</th>
<th scope="col">
&lt;dbl&gt;
</th>
<th scope="col">
&lt;dbl&gt;
</th>
<th scope="col">
&lt;dbl&gt;
</th>
<th scope="col">
&lt;dbl&gt;
</th>
<th scope="col">
&lt;dbl&gt;
</th>
<th scope="col">
&lt;dbl&gt;
</th>
<th scope="col">
&lt;dbl&gt;
</th>
<th scope="col">
&lt;dbl&gt;
</th>
<th scope="col">
&lt;dbl&gt;
</th>
<th scope="col">
⋯
</th>
<th scope="col">
&lt;dbl&gt;
</th>
<th scope="col">
&lt;dbl&gt;
</th>
<th scope="col">
&lt;lgl&gt;
</th>
<th scope="col">
&lt;dbl&gt;
</th>
<th scope="col">
&lt;dbl&gt;
</th>
<th scope="col">
&lt;dbl&gt;
</th>
<th scope="col">
&lt;dbl&gt;
</th>
<th scope="col">
&lt;lgl&gt;
</th>
<th scope="col">
&lt;dbl&gt;
</th>
<th scope="col">
&lt;dbl&gt;
</th>
</tr>
</thead>
<tbody>
<tr>
<th scope="row">
1
</th>
<td>
2018-07-20 08:30:00
</td>
<td>
2.872084
</td>
<td>
-3.939352e-16
</td>
<td>
6.931732e-06
</td>
<td>
2.873170
</td>
<td>
-2.289284
</td>
<td>
15.86938
</td>
<td>
0.007254132
</td>
<td>
0.0006009614
</td>
<td>
1.062143
</td>
<td>
⋯
</td>
<td>
-1.567917e-07
</td>
<td>
0.1052858
</td>
<td>
NA
</td>
<td>
228.8337
</td>
<td>
0.3484284
</td>
<td>
0
</td>
<td>
0
</td>
<td>
NA
</td>
<td>
123.2512
</td>
<td>
103.1085
</td>
</tr>
<tr>
<th scope="row">
2
</th>
<td>
2018-07-20 09:00:00
</td>
<td>
2.864793
</td>
<td>
7.504684e-17
</td>
<td>
9.052527e-08
</td>
<td>
2.864538
</td>
<td>
-2.326045
</td>
<td>
16.55190
</td>
<td>
0.007584267
</td>
<td>
0.0005978138
</td>
<td>
1.105122
</td>
<td>
⋯
</td>
<td>
-2.294700e-07
</td>
<td>
0.1600703
</td>
<td>
NA
</td>
<td>
226.7274
</td>
<td>
0.7745417
</td>
<td>
0
</td>
<td>
0
</td>
<td>
NA
</td>
<td>
187.3839
</td>
<td>
162.6196
</td>
</tr>
<tr>
<th scope="row">
3
</th>
<td>
2018-07-20 09:30:00
</td>
<td>
3.996526
</td>
<td>
9.365292e-16
</td>
<td>
3.049021e-05
</td>
<td>
4.002522
</td>
<td>
-2.035397
</td>
<td>
17.05704
</td>
<td>
0.007472065
</td>
<td>
0.0005954894
</td>
<td>
1.409495
</td>
<td>
⋯
</td>
<td>
-1.862787e-07
</td>
<td>
0.1533514
</td>
<td>
NA
</td>
<td>
243.3803
</td>
<td>
0.2888957
</td>
<td>
0
</td>
<td>
0
</td>
<td>
NA
</td>
<td>
179.5185
</td>
<td>
123.5711
</td>
</tr>
<tr>
<th scope="row">
4
</th>
<td>
2018-07-20 10:00:00
</td>
<td>
4.998016
</td>
<td>
-2.812846e-16
</td>
<td>
-2.391239e-06
</td>
<td>
4.997530
</td>
<td>
-1.977737
</td>
<td>
17.60447
</td>
<td>
0.006762097
</td>
<td>
0.0005953881
</td>
<td>
1.289326
</td>
<td>
⋯
</td>
<td>
-1.504328e-07
</td>
<td>
0.1556649
</td>
<td>
NA
</td>
<td>
246.6840
</td>
<td>
0.3483120
</td>
<td>
0
</td>
<td>
0
</td>
<td>
NA
</td>
<td>
182.2267
</td>
<td>
123.4474
</td>
</tr>
<tr>
<th scope="row">
5
</th>
<td>
2018-07-20 10:30:00
</td>
<td>
4.879095
</td>
<td>
4.062636e-16
</td>
<td>
2.187117e-05
</td>
<td>
4.880696
</td>
<td>
-2.014489
</td>
<td>
18.08994
</td>
<td>
0.005410862
</td>
<td>
0.0005948927
</td>
<td>
1.469949
</td>
<td>
⋯
</td>
<td>
-1.989823e-07
</td>
<td>
0.1914488
</td>
<td>
NA
</td>
<td>
244.5783
</td>
<td>
0.6531922
</td>
<td>
0
</td>
<td>
0
</td>
<td>
NA
</td>
<td>
224.1166
</td>
<td>
191.1642
</td>
</tr>
<tr>
<th scope="row">
6
</th>
<td>
2018-07-20 11:00:00
</td>
<td>
5.225037
</td>
<td>
-8.977916e-17
</td>
<td>
-6.972624e-06
</td>
<td>
5.223984
</td>
<td>
-2.261205
</td>
<td>
18.24207
</td>
<td>
0.004422858
</td>
<td>
0.0005954766
</td>
<td>
1.319227
</td>
<td>
⋯
</td>
<td>
-1.330638e-07
</td>
<td>
0.1490271
</td>
<td>
NA
</td>
<td>
230.4425
</td>
<td>
0.4471074
</td>
<td>
0
</td>
<td>
0
</td>
<td>
NA
</td>
<td>
174.4563
</td>
<td>
150.8430
</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="post-processing-of-raw-eddy-covariance-data.html#cb8-1" aria-hidden="true"></a><span class="kw">saveRDS</span>(dat,<span class="dt">file=</span><span class="st">&quot;../data/ec-data_30min_processed/processed_data_example.rds&quot;</span>)</span></code></pre></div>
<p>Additionally, the data can be gap-filled with <code>gapfilling</code> or averaged to other customized averaging intervals with <code>averaging</code>. Note, different sensors may require different correction methods, see also <span class="citation">Foken (<a href="#ref-Foken2017" role="doc-biblioref">2017</a>)</span>.</p>

</div>
</div>
<h3>References</h3>
<div id="refs" class="references hanging-indent">
<div id="ref-Foken2017">
<p>Foken, T. 2017. “Micrometeorology.” <em>Springer Berlin, Heidelberg</em>.</p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="index.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="turbulence-diagnostics.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": null,
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["series.pdf"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "section",
"scroll_highlight": true
},
"toc depth": 2,
"github-repo": "noctiluc3nt/ec_analyze"
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
